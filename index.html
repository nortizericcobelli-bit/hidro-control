import React, { useState, useEffect } from 'react';
import { 
  Activity, Zap, Timer, Droplet, Thermometer, 
  Waves, Beaker, Sun, Wind, ArrowLeft, 
  Container 
} from 'lucide-react';
import { 
  AreaChart, Area, XAxis, YAxis, CartesianGrid, 
  Tooltip, ResponsiveContainer 
} from 'recharts';

const App = () => {
  const [activePanel, setActivePanel] = useState('overview');
  const [history, setHistory] = useState([]);
  const [solutionLevel, setSolutionLevel] = useState(85);
  const [timeLeft, setTimeLeft] = useState(15 * 24 * 60 * 60);

  // Datos simulados de sensores
  const [data] = useState({
    ph: { val: 6.2, target: 6.0, unit: 'pH', status: 'OK', color: '#3b82f6' },
    ec: { val: 1850, target: 1800, unit: 'PPM', status: 'OK', color: '#10b981' },
    waterTemp: { val: 22.4, target: 22.0, unit: '°C', status: 'OK', color: '#06b6d4' },
    airTemp: { val: 26.8, target: 25.0, unit: '°C', status: 'ALERTA', color: '#f59e0b' },
    humidity: { val: 55, target: 60, unit: '%', status: 'OK', color: '#8b5cf6' },
    light: { val: 85, target: 100, unit: '%', status: 'ON', color: '#facc15' }
  });

  // Temporizador para el cambio de solución
  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(prev => (prev > 0 ? prev - 1 : 15 * 24 * 60 * 60));
    }, 1000);
    return () => clearInterval(timer);
  }, []);

  const formatTime = (seconds) => {
    const d = Math.floor(seconds / (3600 * 24));
    const h = Math.floor((seconds % (3600 * 24)) / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return `${d}d ${h}h ${m}m ${s}s`;
  };

  // Generador de historial para gráficas
  useEffect(() => {
    const interval = setInterval(() => {
      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      setHistory(prev => {
        const newData = [...prev, { 
          time, 
          ph: 6.2 + (Math.random() * 0.1 - 0.05), 
          ec: 1850 + (Math.random() * 20 - 10),
          hum: 55 + (Math.random() * 2 - 1)
        }];
        return newData.slice(-20);
      });
    }, 3000);
    return () => clearInterval(interval);
  }, []);

  const MiniCard = ({ id, title, icon: Icon, sensor }) => (
    <button 
      onClick={() => setActivePanel(id)}
      className="bg-slate-900/60 border border-white/10 p-6 rounded-[2rem] hover:bg-white/5 transition-all text-left w-full group"
    >
      <div className="flex justify-between items-start mb-4">
        <div className="p-2 bg-white/5 rounded-xl group-hover:scale-110 transition-transform" style={{ color: sensor.color }}>
          <Icon size={20} />
        </div>
        <span className="text-[10px] font-bold text-emerald-500 uppercase">{sensor.status}</span>
      </div>
      <h3 className="text-xs font-bold text-slate-500 uppercase tracking-wider">{title}</h3>
      <div className="flex items-baseline gap-1 mt-1">
        <span className="text-2xl font-black text-white">{sensor.val}</span>
        <span className="text-[10px] text-slate-500">{sensor.unit}</span>
      </div>
    </button>
  );

  const DetailedView = ({ title, sensor, dataKey, color }) => (
    <div className="space-y-6 animate-in fade-in duration-500">
      <button 
        onClick={() => setActivePanel('overview')} 
        className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"
      >
        <ArrowLeft size={20} /> Volver al panel principal
      </button>
      <div className="bg-slate-900 border border-white/10 p-8 rounded-[3rem]">
        <h2 className="text-3xl font-black uppercase italic text-white mb-6 tracking-tighter">{title}</h2>
        <div className="h-[350px] w-full">
          <ResponsiveContainer width="100%" height="100%">
            <AreaChart data={history}>
              <defs>
                <linearGradient id="colorVar" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor={color} stopOpacity={0.3}/>
                  <stop offset="95%" stopColor={color} stopOpacity={0}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
              <XAxis dataKey="time" stroke="#444" fontSize={10} axisLine={false} tickLine={false} />
              <YAxis stroke="#444" fontSize={10} axisLine={false} tickLine={false} />
              <Tooltip 
                contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '12px' }}
                itemStyle={{ color: '#fff', fontSize: '12px', fontWeight: 'bold' }}
              />
              <Area type="monotone" dataKey={dataKey} stroke={color} fill="url(#colorVar)" strokeWidth={4} />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-[#050505] text-slate-200 p-4 md:p-8 font-sans selection:bg-blue-500/30">
      <div className="max-w-6xl mx-auto">
        <header className="flex justify-between items-center mb-12">
          <div>
            <div className="flex items-center gap-2 text-blue-500">
              <Waves size={28} />
              <h1 className="text-3xl font-black uppercase italic tracking-tighter text-white leading-none">HidroMaster v2</h1>
            </div>
            <p className="text-[10px] font-mono uppercase tracking-[0.4em] text-slate-500 mt-2">Sistema de Control Industrial</p>
          </div>
          <div className="flex items-center gap-3 bg-slate-900/80 px-4 py-2 rounded-2xl border border-white/5 backdrop-blur-md">
             <Container size={16} className="text-blue-400" />
             <div className="flex flex-col">
                <span className="text-[10px] uppercase font-bold text-slate-500 leading-none">Nivel Solución</span>
                <span className="text-sm font-black text-white">{solutionLevel}%</span>
             </div>
          </div>
        </header>

        {activePanel === 'overview' ? (
          <div className="space-y-8 animate-in fade-in zoom-in-95 duration-500">
            <div className="grid grid-cols-2 lg:grid-cols-3 gap-4">
              <MiniCard id="ph" title="pH Agua" icon={Beaker} sensor={data.ph} />
              <MiniCard id="ec" title="Nutrientes EC" icon={Zap} sensor={data.ec} />
              <MiniCard id="temp" title="Temp. Agua" icon={Thermometer} sensor={data.waterTemp} />
              <MiniCard id="aire" title="Temp. Aire" icon={Wind} sensor={data.airTemp} />
              <MiniCard id="humedad" title="Humedad" icon={Droplet} sensor={data.humidity} />
              <MiniCard id="light" title="Luz" icon={Sun} sensor={data.light} />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="bg-slate-900/40 border border-white/10 p-10 rounded-[3rem] relative overflow-hidden group">
                <div className="relative z-10">
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Próximo cambio de solución</p>
                  <h3 className="text-4xl font-black text-white mb-8 tabular-nums tracking-tighter">{formatTime(timeLeft)}</h3>
                  <div className="flex gap-4">
                    <button className="flex-1 py-4 px-6 rounded-2xl font-black text-[10px] uppercase tracking-widest bg-white/5 hover:bg-red-500 transition-all active:scale-95">Vacear Tanque</button>
                    <button className="flex-1 py-4 px-6 rounded-2xl font-black text-[10px] uppercase tracking-widest bg-white/5 hover:bg-emerald-500 transition-all active:scale-95">Rellenar</button>
                  </div>
                </div>
                <Timer size={120} className="absolute -bottom-4 -right-4 text-white/5 group-hover:text-white/10 transition-colors" />
              </div>

              <div className="bg-gradient-to-br from-blue-600 to-blue-800 p-10 rounded-[3rem] text-white flex flex-col justify-center relative overflow-hidden">
                <div className="relative z-10">
                  <Activity size={32} className="mb-4 opacity-80" />
                  <h4 className="text-2xl font-black mb-2 italic uppercase tracking-tighter">Sincronización Activa</h4>
                  <p className="text-sm opacity-90 leading-relaxed font-medium">Todos los parámetros están dentro del rango operativo. Las bombas de oxígeno están programadas para activarse en 12 minutos.</p>
                </div>
                <div className="absolute top-0 right-0 p-8 opacity-20">
                  <Zap size={140} />
                </div>
              </div>
            </div>
          </div>
        ) : (
          <div className="max-w-4xl mx-auto">
            {activePanel === 'ph' && <DetailedView title="Nivel de pH" sensor={data.ph} dataKey="ph" color="#3b82f6" />}
            {activePanel === 'ec' && <DetailedView title="Conductividad (EC)" sensor={data.ec} dataKey="ec" color="#10b981" />}
            {activePanel === 'temp' && <DetailedView title="Temperatura Agua" sensor={data.waterTemp} dataKey="ph" color="#06b6d4" />}
            {activePanel === 'aire' && <DetailedView title="Temperatura Aire" sensor={data.airTemp} dataKey="ph" color="#f59e0b" />}
            {activePanel === 'humedad' && <DetailedView title="Humedad Relativa" sensor={data.humidity} dataKey="hum" color="#8b5cf6" />}
            {activePanel === 'light' && <DetailedView title="Intensidad de Luz" sensor={data.light} dataKey="ph" color="#facc15" />}
          </div>
        )}
      </div>
    </div>
  );
};

export default App;
